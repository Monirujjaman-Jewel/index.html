<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SIS AI Talent Club - Teacher Assistant</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f6f7fb; margin:0; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 18px; }
    .card { background:#fff; border-radius:18px; box-shadow: 0 10px 24px rgba(0,0,0,.08); overflow:hidden; }
    .header { padding:14px 16px; background:#101828; color:#fff; display:flex; justify-content:space-between; gap:12px; align-items:center; }
    .brand { display:flex; gap:12px; align-items:center; }
    .logo {
      width:44px; height:44px; border-radius:12px; background:#fff; display:flex; align-items:center; justify-content:center;
      overflow:hidden; flex:0 0 auto;
    }
    .logo svg { width:36px; height:36px; }
    .title b { font-size: 16px; display:block; }
    .title small { opacity:.85; }
    .controls { display:flex; gap:10px; align-items:center; }
    .btn { padding:10px 12px; border-radius: 12px; border:0; background:#111827; color:#fff; cursor:pointer; }
    .btn.secondary { background:#334155; }
    .toggle { display:flex; border:1px solid rgba(255,255,255,.25); border-radius: 999px; overflow:hidden; }
    .toggle button { border:0; padding:8px 10px; background:transparent; color:#fff; cursor:pointer; font-size:12px; }
    .toggle button.active { background:rgba(255,255,255,.18); }
    .chips { padding: 10px 12px 0; display:flex; gap:8px; flex-wrap:wrap; background:#fff; }
    .chip { background:#f3f4f6; border:1px solid #e5e7eb; border-radius:999px; padding:8px 10px; cursor:pointer; font-size:13px; }
    .chat { height: 430px; overflow:auto; padding: 16px; background: linear-gradient(#fff, #fbfbff); }
    .row { display:flex; margin: 10px 0; }
    .bot { justify-content:flex-start; }
    .user { justify-content:flex-end; }
    .bubble { max-width: 78%; padding: 10px 12px; border-radius: 14px; line-height:1.35; white-space:pre-wrap; }
    .bot .bubble { background:#eef2ff; border:1px solid #dbeafe; }
    .user .bubble { background:#dcfce7; border:1px solid #bbf7d0; }
    .typing {
      display:inline-flex; gap:4px; align-items:center;
    }
    .dot {
      width:6px; height:6px; border-radius:50%;
      background:#475569; opacity:.6;
      animation: bounce 1s infinite;
    }
    .dot:nth-child(2){ animation-delay:.12s; }
    .dot:nth-child(3){ animation-delay:.24s; }
    @keyframes bounce {
      0%, 80%, 100% { transform: translateY(0); opacity:.45; }
      40% { transform: translateY(-4px); opacity:.9; }
    }
    .inputbar { display:flex; gap:10px; padding: 12px; border-top:1px solid #eee; background:#fff; }
    input { flex:1; padding: 12px; border-radius: 12px; border:1px solid #e5e7eb; outline:none; }
    .send { padding: 12px 14px; border-radius: 12px; border:0; background:#111827; color:#fff; cursor:pointer; }
    .hint { font-size:12px; opacity:.75; margin-left:8px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="header">
        <div class="brand">
          <!-- SIS LOGO PLACEHOLDER:
               Replace this <svg> with your real SIS logo image if you want.
               Easiest: change the .logo content to <img src="sis-logo.png" style="width:100%;height:100%;object-fit:contain;background:#fff" />
               and upload sis-logo.png with this HTML. -->
          <div class="logo" aria-label="SIS Logo">
            <svg viewBox="0 0 64 64" role="img" aria-label="SIS">
              <circle cx="32" cy="32" r="28" fill="#111827"/>
              <text x="32" y="38" text-anchor="middle" font-family="Arial" font-size="18" fill="#ffffff">SIS</text>
            </svg>
          </div>

          <div class="title">
            <b id="hdrTitle">SIS AI Talent Club ‚Ä¢ Teacher Assistant (Mon 2:10‚Äì2:50)</b>
            <small id="hdrSub">Welcome bot ‚Ä¢ Name saved on this device ‚Ä¢ Bn/En</small>
          </div>
        </div>

        <div class="controls">
          <div class="toggle" title="Language">
            <button id="enBtn" class="active">EN</button>
            <button id="bnBtn">BN</button>
          </div>
          <button class="btn secondary" id="missionBtn">Today‚Äôs mission</button>
          <button class="btn" id="resetBtn" title="Forget saved name">Reset</button>
        </div>
      </div>

      <div class="chips" id="chips"></div>

      <div id="chat" class="chat"></div>

      <div class="inputbar">
        <input id="msg" placeholder="Type your message‚Ä¶ (Example: My name is Aisha)" />
        <button class="send" id="send">Send</button>
      </div>
    </div>
    <div class="hint" id="footerHint"></div>
  </div>

<script>
  const chatEl = document.getElementById('chat');
  const msgEl = document.getElementById('msg');
  const sendEl = document.getElementById('send');
  const resetBtn = document.getElementById('resetBtn');
  const chipsEl = document.getElementById('chips');
  const enBtn = document.getElementById('enBtn');
  const bnBtn = document.getElementById('bnBtn');
  const missionBtn = document.getElementById('missionBtn');
  const footerHint = document.getElementById('footerHint');

  const NAME_KEY = "ai_talent_club_student_name_v1";
  const LANG_KEY = "ai_talent_club_lang_v1";

  let studentName = localStorage.getItem(NAME_KEY) || "";
  let lang = localStorage.getItem(LANG_KEY) || "en"; // "en" | "bn"

  function normalize(s){ return (s || "").trim().toLowerCase(); }

  function extractName(input) {
    const text = input.trim();

    // English patterns
    const patternsEN = [
      /my name is\s+([a-zA-Z][a-zA-Z\s'-]{1,30})/i,
      /i am\s+([a-zA-Z][a-zA-Z\s'-]{1,30})/i,
      /i'm\s+([a-zA-Z][a-zA-Z\s'-]{1,30})/i,
      /name\s*:\s*([a-zA-Z][a-zA-Z\s'-]{1,30})/i,
    ];

    // Bangla-friendly quick patterns: "‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ___", "‡¶®‡¶æ‡¶Æ: ___"
    const patternsBN = [
      /‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ\s+([^\n\r]{1,30})/i,
      /‡¶®‡¶æ‡¶Æ\s*[:Ôºö]\s*([^\n\r]{1,30})/i,
    ];

    const patterns = [...patternsEN, ...patternsBN];
    for (const p of patterns) {
      const m = text.match(p);
      if (m && m[1]) return m[1].trim();
    }
    return "";
  }

  function withName(lineEN, lineBN){
    const name = studentName ? studentName : (lang === "bn" ? "‡¶¨‡¶®‡ßç‡¶ß‡ßÅ" : "friend");
    const line = (lang === "bn" ? lineBN : lineEN);
    return line.replaceAll("{name}", name);
  }

  function addBubble(text, who="bot") {
    const row = document.createElement('div');
    row.className = `row ${who}`;
    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    bubble.textContent = text;
    row.appendChild(bubble);
    chatEl.appendChild(row);
    chatEl.scrollTop = chatEl.scrollHeight;
    return bubble;
  }

  // Typing indicator: show "Assistant is typing‚Ä¶" + dots, then replace with final text.
  function addTypingBubble() {
    const row = document.createElement('div');
    row.className = 'row bot';
    const bubble = document.createElement('div');
    bubble.className = 'bubble';

    const label = document.createElement('div');
    label.textContent = (lang === "bn") ? "Assistant ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡¶õ‡ßá‚Ä¶" : "Assistant is typing‚Ä¶";

    const typing = document.createElement('div');
    typing.className = 'typing';
    typing.setAttribute('aria-hidden', 'true');
    typing.innerHTML = `<span class="dot"></span><span class="dot"></span><span class="dot"></span>`;

    bubble.appendChild(label);
    bubble.appendChild(typing);
    row.appendChild(bubble);
    chatEl.appendChild(row);
    chatEl.scrollTop = chatEl.scrollHeight;

    return bubble;
  }

  function setLang(newLang){
    lang = newLang;
    localStorage.setItem(LANG_KEY, lang);
    enBtn.classList.toggle("active", lang === "en");
    bnBtn.classList.toggle("active", lang === "bn");
    refreshUIStrings();
  }

  function refreshUIStrings(){
    // Input placeholder + footer hint
    msgEl.placeholder = (lang === "bn")
      ? "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‚Ä¶ (‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£: ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶Ü‡ßü‡ßá‡¶∂‡¶æ)"
      : "Type your message‚Ä¶ (Example: My name is Aisha)";

    footerHint.textContent = (lang === "bn")
      ? "‡¶ü‡¶ø‡¶™‡¶∏: ‚ÄúToday‚Äôs mission‚Äù ‡¶ö‡¶æ‡¶™‡ßÅ‡¶®, ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶ú‡¶ø‡¶ú‡ßç‡¶û‡ßá‡¶∏ ‡¶ï‡¶∞‡ßÅ‡¶®: ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßü / ‡¶ï‡ßÄ ‡¶¨‡¶æ‡¶®‡¶æ‡¶¨‡ßã / ‡¶®‡¶ø‡ßü‡¶Æ"
      : "Tip: Click ‚ÄúToday‚Äôs mission‚Äù, or ask: class time / what we will make / rules";

    // Chips
    const chips = (lang === "bn")
      ? [
          { t: "AI Talent Club ‡¶ï‡ßÄ?", q: "AI Talent Club ‡¶ï‡ßÄ?" },
          { t: "‡ß© ‡¶Æ‡¶æ‡¶∏‡ßá ‡¶ï‡ßÄ ‡¶¨‡¶æ‡¶®‡¶æ‡¶¨‡ßã?", q: "‡ß© ‡¶Æ‡¶æ‡¶∏‡ßá ‡¶ï‡ßÄ ‡¶¨‡¶æ‡¶®‡¶æ‡¶¨‡ßã?" },
          { t: "‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶ï‡¶ñ‡¶®?", q: "‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶ï‡¶ñ‡¶®?" },
          { t: "‡ß™‡ß¶ ‡¶ú‡¶®‡ßá ‡¶≤‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶™ ‡¶ï‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá?", q: "‡ß™‡ß¶ ‡¶ú‡¶®‡ßá ‡¶≤‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶™ ‡¶ï‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá?" },
          { t: "‡¶¨‡¶æ‡ßú‡¶ø‡¶§‡ßá ‡¶ï‡ßÄ ‡¶ï‡¶∞‡¶¨‡ßã?", q: "‡¶¨‡¶æ‡ßú‡¶ø‡¶§‡ßá ‡¶ï‡ßÄ ‡¶ï‡¶∞‡¶¨‡ßã?" },
        ]
      : [
          { t: "What is AI Talent Club?", q: "What is AI Talent Club?" },
          { t: "What will we make in 3 months?", q: "What will we make in 3 months?" },
          { t: "When is the class?", q: "When is the class?" },
          { t: "How do laptops work for 40 students?", q: "How do laptops work for 40 students?" },
          { t: "What should I do at home?", q: "What should I do at home?" },
        ];

    chipsEl.innerHTML = "";
    chips.forEach(c => {
      const el = document.createElement('div');
      el.className = 'chip';
      el.textContent = c.t;
      el.dataset.q = c.q;
      el.addEventListener('click', () => {
        msgEl.value = c.q;
        msgEl.focus();
      });
      chipsEl.appendChild(el);
    });

    // Mission button text
    missionBtn.textContent = (lang === "bn") ? "‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Æ‡¶ø‡¶∂‡¶®" : "Today‚Äôs mission";
  }

  // Week number helper (ISO week)
  function getISOWeek(d) {
    const date = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
    const dayNum = date.getUTCDay() || 7;
    date.setUTCDate(date.getUTCDate() + 4 - dayNum);
    const yearStart = new Date(Date.UTC(date.getUTCFullYear(),0,1));
    return Math.ceil((((date - yearStart) / 86400000) + 1) / 7);
  }

  const missions = [
    {
      en: "Mission 1: Find 3 examples of AI in your daily life (phone camera, YouTube, maps). Write them down and bring them next class.",
      bn: "‡¶Æ‡¶ø‡¶∂‡¶® ‡ßß: ‡¶¶‡ßà‡¶®‡¶®‡ßç‡¶¶‡¶ø‡¶® ‡¶ú‡ßÄ‡¶¨‡¶®‡ßá AI-‡¶è‡¶∞ ‡ß©‡¶ü‡¶ø ‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶´‡ßã‡¶® ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ, ‡¶á‡¶â‡¶ü‡¶ø‡¶â‡¶¨, ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™‡¶∏)‡•§ ‡¶≤‡¶ø‡¶ñ‡ßá ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶™‡¶∞‡ßá‡¶∞ ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏‡ßá ‡¶¨‡¶≤‡ßÅ‡¶®‡•§"
    },
    {
      en: "Mission 2: Create 3 smart questions you want to ask a chatbot. Bring them next Monday.",
      bn: "‡¶Æ‡¶ø‡¶∂‡¶® ‡ß®: ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü‡¶¨‡¶ü‡¶ï‡ßá ‡¶ú‡¶ø‡¶ú‡ßç‡¶û‡ßá‡¶∏ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Æ‡¶§‡ßã ‡ß©‡¶ü‡¶ø ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§ ‡¶™‡¶∞‡ßá‡¶∞ ‡¶∏‡ßã‡¶Æ‡¶¨‡¶æ‡¶∞ ‡¶®‡¶ø‡ßü‡ßá ‡¶Ü‡¶∏‡ßÅ‡¶®‡•§"
    },
    {
      en: "Mission 3: Think of one problem in school that AI could help solve. Describe it in 2‚Äì3 lines.",
      bn: "‡¶Æ‡¶ø‡¶∂‡¶® ‡ß©: ‡¶∏‡ßç‡¶ï‡ßÅ‡¶≤‡ßá‡¶∞ ‡¶è‡¶Æ‡¶® ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶≠‡¶æ‡¶¨‡ßÅ‡¶® ‡¶Ø‡ßá‡¶ñ‡¶æ‡¶®‡ßá AI ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§ ‡ß®‚Äì‡ß© ‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§"
    },
    {
      en: "Mission 4: Prompt Challenge! Write one prompt to generate a story about a robot student in SIS. (We‚Äôll test prompts in class.)",
      bn: "‡¶Æ‡¶ø‡¶∂‡¶® ‡ß™: ‡¶™‡ßç‡¶∞‡¶Æ‡ßç‡¶™‡¶ü ‡¶ö‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶û‡ßç‡¶ú! SIS-‡¶è‡¶∞ ‡¶è‡¶ï‡¶ú‡¶® ‡¶∞‡ßã‡¶¨‡¶ü ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶®‡¶ø‡ßü‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ó‡¶≤‡ßç‡¶™ ‡¶§‡ßà‡¶∞‡¶ø‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶Æ‡ßç‡¶™‡¶ü ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§ (‡¶ï‡ßç‡¶≤‡¶æ‡¶∏‡ßá ‡¶ü‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡¶¨‡ßã‡•§)"
    },
    {
      en: "Mission 5: Teamwork prep ‚Äî choose a role you like: Designer, Builder, Tester, Presenter. Tell me your role next class.",
      bn: "‡¶Æ‡¶ø‡¶∂‡¶® ‡ß´: ‡¶ü‡¶ø‡¶Æ‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶ï ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§‡¶ø‚Äî‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡ßã‡¶® ‡¶≠‡ßÇ‡¶Æ‡¶ø‡¶ï‡¶æ ‡¶™‡¶õ‡¶®‡ßç‡¶¶ ‡¶ï‡¶∞‡ßá‡¶®: Designer, Builder, Tester, Presenter‡•§ ‡¶™‡¶∞‡ßá‡¶∞ ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏‡ßá ‡¶¨‡¶≤‡ßÅ‡¶®‡•§"
    }
  ];

  function todaysMissionText() {
    const now = new Date();
    const week = getISOWeek(now);
    const m = missions[week % missions.length];
    return (lang === "bn")
      ? "üéØ " + m.bn
      : "üéØ " + m.en;
  }

  // Knowledge base (bilingual)
  const knowledgeBase = [
    {
      keys: ["what is ai talent club", "ai talent club", "club", "ai talent"],
      answer: () => withName(
        "Hi {name}! üëã Welcome to AI Talent Club.\nHere we learn AI through fun activities and projects. You‚Äôll explore how AI works, use safe AI tools, and build something like a chatbot or mini app idea by the end of the term.",
        "‡¶π‡¶æ‡¶á {name}! üëã AI Talent Club-‡¶è ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ‡•§\n‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶Æ‡¶ú‡¶æ ‡¶ï‡¶∞‡ßá AI ‡¶∂‡¶ø‡¶ñ‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶ø‡•§ AI ‡¶ï‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßá ‡¶¨‡ßÅ‡¶ù‡¶¨‡ßã, ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶‡¶≠‡¶æ‡¶¨‡ßá AI ‡¶ü‡ßÅ‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßã, ‡¶è‡¶¨‡¶Ç ‡¶ü‡¶æ‡¶∞‡ßç‡¶Æ‡ßá‡¶∞ ‡¶∂‡ßá‡¶∑‡ßá ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü‡¶¨‡¶ü ‡¶¨‡¶æ ‡¶õ‡ßã‡¶ü AI ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶Ü‡¶á‡¶°‡¶ø‡ßü‡¶æ ‡¶¨‡¶æ‡¶®‡¶æ‡¶¨‡ßã‡•§"
      )
    },
    {
      keys: ["when is the class", "class time", "time", "monday", "‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶ï‡¶ñ‡¶®", "‡¶∏‡¶Æ‡ßü", "‡¶∏‡ßã‡¶Æ‡¶¨‡¶æ‡¶∞"],
      answer: () => withName(
        "üìÖ {name}, our club meets every Monday, 2:10 pm ‚Äì 2:50 pm.\nEach session is short, fun, and project-based!",
        "üìÖ {name}, ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ï‡ßç‡¶≤‡¶æ‡¶¨ ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∏‡ßã‡¶Æ‡¶¨‡¶æ‡¶∞, ‡ß®:‡ßß‡ß¶ ‚Äì ‡ß®:‡ß´‡ß¶ (‡¶¨‡¶ø‡¶ï‡¶æ‡¶≤)‡•§\n‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶∏‡ßá‡¶∂‡¶® ‡¶õ‡ßã‡¶ü, ‡¶Æ‡¶ú‡¶æ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü-‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï!"
      )
    },
    {
      keys: ["what will we make", "make in 3 months", "projects", "end of term", "‡¶ï‡ßÄ ‡¶¨‡¶æ‡¶®‡¶æ‡¶¨‡ßã", "‡ß© ‡¶Æ‡¶æ‡¶∏‡ßá", "‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü"],
      answer: () => withName(
        "üöÄ By the end of 3 months, {name}, you can create:\n‚Ä¢ A simple chatbot (welcome/quiz/helper)\n‚Ä¢ An AI creative project (story/poster/game idea)\n‚Ä¢ A mini AI app concept (problem ‚Üí AI solution)\nAnd you‚Äôll present it in our mini showcase!",
        "üöÄ ‡ß© ‡¶Æ‡¶æ‡¶∏ ‡¶∂‡ßá‡¶∑‡ßá, {name}, ‡¶Ü‡¶™‡¶®‡¶ø ‡¶¨‡¶æ‡¶®‡¶æ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®:\n‚Ä¢ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶π‡¶ú ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü‡¶¨‡¶ü (‡¶ì‡ßü‡ßá‡¶≤‡¶ï‡¶æ‡¶Æ/‡¶ï‡ßÅ‡¶á‡¶ú/‡¶π‡ßá‡¶≤‡ßç‡¶™‡¶æ‡¶∞)\n‚Ä¢ ‡¶è‡¶ï‡¶ü‡¶ø AI ‡¶ï‡ßç‡¶∞‡¶ø‡ßü‡ßá‡¶ü‡¶ø‡¶≠ ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü (‡¶ó‡¶≤‡ßç‡¶™/‡¶™‡ßã‡¶∏‡ßç‡¶ü‡¶æ‡¶∞/‡¶ó‡ßá‡¶Æ ‡¶Ü‡¶á‡¶°‡¶ø‡ßü‡¶æ)\n‚Ä¢ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶õ‡ßã‡¶ü AI ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶®‡¶∏‡ßá‡¶™‡ßç‡¶ü (‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‚Üí AI ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶®)\n‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶Æ‡¶ø‡¶®‡¶ø ‡¶∂‡ßã‡¶ï‡ßá‡¶∏‡ßá ‡¶™‡ßç‡¶∞‡ßá‡¶ú‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®!"
      )
    },
    {
      keys: ["laptops", "40 students", "rotation", "how do laptops work", "‡¶≤‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶™", "‡ß™‡ß¶", "‡¶∞‡ßã‡¶ü‡ßá‡¶∂‡¶®"],
      answer: () => withName(
        "üíª Great question, {name}.\nWe use a rotation system:\n‚Ä¢ Laptop Zone: small group tries AI\n‚Ä¢ Activity Zone: card/paper games (AI thinking)\n‚Ä¢ Challenge Zone: puzzles + design tasks\nThen groups rotate so everyone gets a turn.",
        "üíª ‡¶¶‡¶æ‡¶∞‡ßÅ‡¶£ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®, {name}‡•§\n‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶∞‡ßã‡¶ü‡ßá‡¶∂‡¶® ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶ø:\n‚Ä¢ Laptop Zone: ‡¶õ‡ßã‡¶ü ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™ AI ‡¶ü‡ßç‡¶∞‡¶æ‡¶á ‡¶ï‡¶∞‡ßá\n‚Ä¢ Activity Zone: ‡¶ï‡¶æ‡¶∞‡ßç‡¶°/‡¶™‡ßá‡¶™‡¶æ‡¶∞ ‡¶ó‡ßá‡¶Æ (AI ‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ)\n‚Ä¢ Challenge Zone: ‡¶™‡¶æ‡¶ú‡¶≤ + ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï\n‡¶§‡¶æ‡¶∞‡¶™‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™ ‡¶ò‡ßÅ‡¶∞‡ßá ‡¶ò‡ßÅ‡¶∞‡ßá ‡¶∏‡¶¨‡¶æ‡¶á ‡¶∏‡ßÅ‡¶Ø‡ßã‡¶ó ‡¶™‡¶æ‡ßü‡•§"
      )
    },
    {
      keys: ["what should i do at home", "homework", "practice", "at home", "‡¶¨‡¶æ‡ßú‡¶ø‡¶§‡ßá", "‡¶π‡ßã‡¶Æ‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶ï", "‡¶™‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ü‡¶ø‡¶∏"],
      answer: () => withName(
        "{name}, try one small challenge at home:\n1) Notice 3 places you see AI.\n2) Write 2 questions to ask next class.\n3) Bring one idea: a school problem AI could help solve.",
        "{name}, ‡¶¨‡¶æ‡ßú‡¶ø‡¶§‡ßá ‡¶õ‡ßã‡¶ü ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ö‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶û‡ßç‡¶ú ‡¶ï‡¶∞‡ßÅ‡¶®:\n1) AI ‡¶ï‡ßã‡¶•‡¶æ‡ßü ‡¶ï‡ßã‡¶•‡¶æ‡ßü ‡¶¶‡ßá‡¶ñ‡ßá‡¶®‚Äî‡ß©‡¶ü‡¶ø ‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§\n2) ‡¶™‡¶∞‡ßá‡¶∞ ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏‡ßá ‡¶ú‡¶ø‡¶ú‡ßç‡¶û‡ßá‡¶∏ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡ß®‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§\n3) ‡¶∏‡ßç‡¶ï‡ßÅ‡¶≤‡ßá‡¶∞ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶≠‡¶æ‡¶¨‡ßÅ‡¶® ‡¶Ø‡ßá‡¶ñ‡¶æ‡¶®‡ßá AI ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§"
      )
    },
    {
      keys: ["rules", "safe", "safety", "ethics", "‡¶®‡¶ø‡ßü‡¶Æ", "‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶", "‡¶è‡¶•‡¶ø‡¶ï‡ßç‡¶∏"],
      answer: () => withName(
        "‚úÖ AI Safety Rules, {name}:\n‚Ä¢ Be respectful\n‚Ä¢ Don‚Äôt share personal info\n‚Ä¢ Use AI to learn‚Äînot to cheat\n‚Ä¢ If something feels wrong, tell the teacher",
        "‚úÖ AI ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ ‡¶®‡¶ø‡ßü‡¶Æ, {name}:\n‚Ä¢ ‡¶≠‡¶¶‡ßç‡¶∞ ‡¶ì ‡¶∏‡¶Æ‡ßç‡¶Æ‡¶æ‡¶®‡¶ú‡¶®‡¶ï ‡¶•‡¶æ‡¶ï‡ßÅ‡¶®\n‚Ä¢ ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶ó‡¶§ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ\n‚Ä¢ ‡¶∂‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø AI ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‚Äî‡¶ö‡¶ø‡¶ü‡¶ø‡¶Ç ‡¶®‡ßü\n‚Ä¢ ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶Ö‡¶∏‡ßç‡¶¨‡¶∏‡ßç‡¶§‡¶ø‡¶ï‡¶∞ ‡¶Æ‡¶®‡ßá ‡¶π‡¶≤‡ßá ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï‡¶ï‡ßá ‡¶¨‡¶≤‡ßÅ‡¶®"
      )
    }
  ];

  function matchKB(input) {
    const t = normalize(input);
    for (const item of knowledgeBase) {
      for (const k of item.keys) {
        if (t.includes(normalize(k))) return item.answer();
      }
    }
    return "";
  }

  function botReply(userText) {
    // Name capture
    const maybeName = extractName(userText);
    if (maybeName) {
      studentName = maybeName;
      localStorage.setItem(NAME_KEY, studentName);
      return withName(
        "Nice to meet you, {name}! üéâ I‚Äôll remember your name on this device.\nTry asking: ‚ÄúWhat will we make in 3 months?‚Äù",
        "‡¶≠‡¶æ‡¶≤‡ßã ‡¶≤‡¶æ‡¶ó‡¶≤‡ßã, {name}! üéâ ‡¶Ü‡¶Æ‡¶ø ‡¶è‡¶á ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶Æ‡¶®‡ßá ‡¶∞‡¶æ‡¶ñ‡¶¨‡ßã‡•§\n‡¶ú‡¶ø‡¶ú‡ßç‡¶û‡ßá‡¶∏ ‡¶ï‡¶∞‡ßÅ‡¶®: ‚Äú‡ß© ‡¶Æ‡¶æ‡¶∏‡ßá ‡¶ï‡ßÄ ‡¶¨‡¶æ‡¶®‡¶æ‡¶¨‡ßã?‚Äù"
      );
    }

    // Ask name if missing
    if (!studentName) {
      return (lang === "bn")
        ? "AI Talent Club-‡¶è ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ! üëã\n‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡ßÄ?\n(‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®: ‚Äú‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ____‚Äù)"
        : "Welcome to AI Talent Club! üëã\nWhat‚Äôs your name?\n(Type: ‚ÄúMy name is ____‚Äù)";
    }

    // Mission requests
    const t = normalize(userText);
    if (t.includes("mission") || t.includes("today's mission") || t.includes("‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Æ‡¶ø‡¶∂‡¶®") || t.includes("‡¶Æ‡¶ø‡¶∂‡¶®")) {
      return todaysMissionText();
    }

    // KB answer
    const kb = matchKB(userText);
    if (kb) return kb;

    // Default
    return withName(
      "Thanks, {name}! üëç\nI can help with:\n‚Ä¢ Club info (time, rules, projects)\n‚Ä¢ AI basics (data, learning, chatbots)\nClick ‚ÄúToday‚Äôs mission‚Äù for your weekly challenge.",
      "‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶, {name}! üëç\n‡¶Ü‡¶Æ‡¶ø ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø:\n‚Ä¢ ‡¶ï‡ßç‡¶≤‡¶æ‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø (‡¶∏‡¶Æ‡ßü, ‡¶®‡¶ø‡ßü‡¶Æ, ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü)\n‚Ä¢ AI ‡¶¨‡ßá‡¶∏‡¶ø‡¶ï (‡¶°‡¶æ‡¶ü‡¶æ, ‡¶≤‡¶æ‡¶∞‡ßç‡¶®‡¶ø‡¶Ç, ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü‡¶¨‡¶ü)\n‡¶∏‡¶æ‡¶™‡ßç‡¶§‡¶æ‡¶π‡¶ø‡¶ï ‡¶ö‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶û‡ßç‡¶ú‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‚Äú‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Æ‡¶ø‡¶∂‡¶®‚Äù ‡¶ö‡¶æ‡¶™‡ßÅ‡¶®‡•§"
    );
  }

  function send() {
    const text = msgEl.value.trim();
    if (!text) return;
    addBubble(text, "user");
    msgEl.value = "";

    // Typing indicator + delayed response
    const typingBubble = addTypingBubble();
    const delay = 450 + Math.floor(Math.random() * 450);

    setTimeout(() => {
      const reply = botReply(text);
      typingBubble.textContent = reply; // replace typing bubble with final text
      chatEl.scrollTop = chatEl.scrollHeight;
    }, delay);
  }

  function boot() {
    addBubble(lang === "bn"
      ? "üëã ‡¶π‡ßç‡¶Ø‡¶æ‡¶≤‡ßã! ‡¶Ü‡¶Æ‡¶ø SIS AI Talent Club-‡¶è‡¶∞ Teacher Assistant‡•§"
      : "üëã Hello! I‚Äôm the SIS AI Talent Club Teacher Assistant."
    );

    if (studentName) {
      addBubble(withName(
        "Welcome back, {name}! Ask me anything‚Äîor click ‚ÄúToday‚Äôs mission‚Äù.",
        "‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ, {name}! ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶ú‡¶ø‡¶ú‡ßç‡¶û‡ßá‡¶∏ ‡¶ï‡¶∞‡ßÅ‡¶®‚Äî‡¶Ö‡¶•‡¶¨‡¶æ ‚Äú‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Æ‡¶ø‡¶∂‡¶®‚Äù ‡¶ö‡¶æ‡¶™‡ßÅ‡¶®‡•§"
      ));
    } else {
      addBubble(lang === "bn"
        ? "‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá‚Äî‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡ßÄ?\n‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®: ‚Äú‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ____‚Äù"
        : "Before we start ‚Äî what‚Äôs your name?\nType: ‚ÄúMy name is ____‚Äù"
      );
    }
  }

  // Events
  sendEl.addEventListener('click', send);
  msgEl.addEventListener('keydown', (e) => { if (e.key === "Enter") send(); });

  resetBtn.addEventListener('click', () => {
    localStorage.removeItem(NAME_KEY);
    studentName = "";
    chatEl.innerHTML = "";
    boot();
  });

  enBtn.addEventListener('click', () => setLang("en"));
  bnBtn.addEventListener('click', () => setLang("bn"));

  missionBtn.addEventListener('click', () => {
    // Show mission with typing indicator too
    const typingBubble = addTypingBubble();
    const delay = 350 + Math.floor(Math.random() * 350);
    setTimeout(() => {
      typingBubble.textContent = todaysMissionText();
      chatEl.scrollTop = chatEl.scrollHeight;
    }, delay);
  });

  // Init
  setLang(lang);
  boot();
</script>
</body>
</html>
